# mariah_carey_christmas

'Mariah Carey' - 'All I want for Christmas is you' 음원 순위 예측 프로젝트

### 📆_기간

- 2020년 12월 ~ 2021년 1월(2개월)

### 🖍_주제 및 동기

- 한국에 **벚꽃연금**이 있다면, 미국은 이 사람이다.
    
    'Mariah Carey'의 'All I want for Christmas is you'는 10년이 넘는 기간동안 매년 크리스마스가 다가오면 서서히 모습을 드러내고, 1위를 탈환한 뒤 급격하게 다시 순위표에서 사라지는 대표적인 음원이다. 이 **음원의 이러한 패턴은 기온과 연관관계가 있을까**? 하는 생각이 시작의 발단이었다.
    

### 📃_프로젝트 요약

- 2011년 2월부터 2021년 1월까지의 **itunes 세계, 미국, 영국 음원 순위와, 동일 기간 영국, 미국의 기온 데이터를 토대로 기온에 따른 음원 순위 변화를 예측**해본다.

### 🎭_주요 역할

- 일간 음원, 기온 데이터 스크래핑
- 데이터 엔지니어링을 통해 LSTM 모델에 적합한 데이터 형식으로 만들어준다.
- 모델을 학습시키고 결과를 도출한다.
- 도출된 결과를 시각화 하여 표현한다.

### 🌞_세부 역할

- **데이터**
    - 일간 음원 순위 스크래핑(2011.02 ~ 2021.01)
        - **itunes 음원 순위** : **Billboard는 순위표** 진입에 각종 제한(일정 기준을 충족하지 못하면 오래된 곡은 차트 아웃)이 있고, 'All I want for Christmas is you'의 음원 순위를 스크래핑 할 수 있는 기준의 데이터는 **유료로 판매하고 있어, itunes 음원 순위**를 선정.
        - **세계, 미국, 영국 음원 순위** : 세계 음원 순위는 프로젝트 목적의 핵심적인 대상이고, **미국과 영국은 각각 세계 1위, 2위의 음악 시장**을 보유하고 있어 세계 음원 순위 예측에 필요한 데이터이다. **정적 페이지로 BeautifulSoup**을 통해 스크래핑.
    - 일간 기온 데이터 스크래핑(2011.02 ~ 2021.01)
        - 미국, 영국 기온 데이터 : 최대 음악 시장 보유국들의 기온을 스크래핑하였다. **겨울에 크리스마스를 맞는 국가**이기도 하다. **화씨 데이터를 섭씨 데이터로 변환**.
    - 데이터 병합 및 CSV 파일로의 저장
        - 수집한 음원 순위 데이터와 기온 데이터를 병합하고, 데이터 활용을 위해 CSV 파일로 저장했다.
- **모델 구축**
    - 데이터 정제
        - 데이터의 형태를 파악하고 **결측값**을 대체하였다. **음원 데이터는 400(350위까지 기록됨) 또는 앞 순위, 기온 데이터는 전 날의 기온으로 대체**하였다.
        - **날짜(2018-12-31)를 기준으로 전자는 훈련, 후자는 테스트** 데이터로 정하였다.
        - 학습을 위한 **윈도우(90일치씩)를 생성하여 데이터셋을 생성**하였다.
    - LSTM : 여러 데이터들 사이에서 과거의 순위를 학습하는 데 적합하다.
        - input_shape=(90, 5) : lstm 층에의 데이터 입력 형태로, 윈도우 90개에 컬럼 5개의 형태이다.
    - Random Forest
        - Classifier : 랜덤 포레스트 분류기를 이용하여 **음원 순위 차트인 여부**를 구분하였다.
        - Regressor : 랜덤포레스트 회귀를 이용하여 **WDRank(세계 순위)를 예측**해보았다.
- **결과 도출 및 시각화**
    - 데이터 결과 도출
        
        학습된 모델을 토대로 **테스트 값과 예측값을 비교**하였고, 학습된 모델과 실제 값 사이의 오차를 측정하였다.
        
    - 결과 시각화
    pandas의 기본 기능을 사용한 그래프를 통해 테스트 값, 예측값을 비교하고 오차 양상을 표현하였다.
    

### 🛠_사용 기술

- 사용 언어 - Python
- Tool - Google Colab
- 사용 라이브러리 - Tensorflow2, Keras, Pandas, Numpy, Beautiful Soup, Selenium, Matplotlib

### 🚣‍♀️_팀 구성

- 개인 프로젝트

### ‼_이슈

- **첫 개인 프로젝트**였던 만큼 많은 것들을 배울 수 있었다.
- 음원 스크래핑을 할 때, beautiful soup에서 **html 위치**를 잘 인식하지 못하였는데, 위치 **하나하나 대조해가며 맞는 위치와 인덱싱, 슬라이싱 위치를 찾아**내었다.
- 기온 스크래핑을 할 때, **위치 별 데이터 로딩 시간**이 있었던 것을 모르고 계속 에러를 확인하였다. 나중에 로딩 시간이 있다는 것을 인식하고 **대기 시간**을 주었다.
- 기온 스크래핑을 할 때 데이터가 html상의 여러 레이어 속에 숨어있었는데, **숨은 레이어를 찾아서 데이터를 뽑는 데 많은 어려움**이 있었다. 이 역시 여러 번 **위치를 변경해가며 테스트하고 성공**하였다.
- 음원이 **차트아웃을 하는 경우**, 아예 순위를 확인할 수 없었는데 **모두 400위로 치환**하였다.

### 💡_배운 것

- **Pandas와 Numpy를 이용하여 데이터 프레임에서 원하는 값들을 추출하고 가공**하는 것을 익힐 수 있었다.
- **Pandas를 이용한 plot을 처음 표출해보았고, lstm의 history 변수를 표현**해볼 수 있었다.
- 리스트를 만들 때 공백 리스트를 항상 위에 몰아놓는 습관이 있었는데, 이번 스크래핑 과정에서 실수로 **수집한 데이터를 여러 번 날려먹었다**. 덕분에 **각 함수나 과정을 나누어 공백 리스트를 설정**하게 되었고, **공백 리스트나 데이터 프레임을 두는 위치가 중요하다**는 것을 알게 되었다.
- 스트래핑한 데이터를 **리스트로 만들고 병합하는 과정에서 병합 실수로 또 수집한 데이터를 여러 번 날렸다**. 때문에 **복제 리스트나 데이터 프레임을 만들어, 원본을 보호하는 것이 중요**하다는 것을 깨닫게 되었다.
- LSTM을 처음 사용해 보았던 프로젝트였는데, **lstm의 구조와 keras에서의 사용**을 익힐 수 있었다.
- **하나의 데이터로 분류, 예측, 머신러닝, 딥러닝 모델을 적용하며 다양한 활용**을 해볼 수 있었던 기회였다.

### ✨_발전 방향

- 단순히 순위 변화를 예측하는 것이 아니라, 그 **날짜를 예측해보고자** 한다.
- **차트 아웃 기간을 제외하고 순위 변화 프로젝트를 진행**해보려고 한다.
- 순위 예측 모델을 프로그램화 하여, 기온과 음원 순위 입력 시 세계 음원 순위와 날짜를 예측하고자 한다.
- **클라우드 서버 배포**
    - 미국에서는 'Mariah Carey'의 'All I want for Christmas is you'를 크리스마스 즈음에 무조건적으로 들어야하는 음악으로 이미 하나의 '밈'으로 자리잡았다고 한다. 배포가 된다면 모두에게 즐거움을 주는 프로그램이 될 수 있을 것이라고 생각한다.
- **벚꽃 엔딩**의 음원 데이터를 수집하여, 국내 순위 변동을 예측해도 흥미로울 것이라고 생각한다.
- 시각화가 부족한 듯 하여 **seaborn이나 tableau, excel의 사용을 고려**하고 있다.
